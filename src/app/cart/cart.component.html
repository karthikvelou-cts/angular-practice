@if (isLoading()) {
  <div class="cart-container">
    <h2>Your Cart</h2>
    <div class="cart-items">
      @for (item of [1, 2]; track item) {
        <div class="cart-item">
          <div class="skeleton item-image"></div>
          <div class="item-details">
            <div class="skeleton skeleton-text" style="width: 70%; height: 1.1rem;"></div>
            <div class="skeleton skeleton-text" style="width: 100px; height: 1rem; margin-top: 0.5rem;"></div>
          </div>
          <div class="skeleton remove-btn-skeleton"></div>
        </div>
      }
    </div>
    <div class="cart-summary">
      <div class="skeleton" style="width: 200px; height: 1.5rem; margin-left: auto;"></div>
      <div class="skeleton checkout-btn-skeleton" style="margin-left: auto; margin-top: 1rem;"></div>
    </div>
  </div>
} @else {
  @if (authService.currentUser()) {
    <div class="cart-container">
      <h2>Your Cart</h2>
      @if (cartService.cartItems().length === 0 && !showOrderSuccess()) {
        <p class="empty-cart">Your cart is empty. ðŸŽ‰</p>
      } @else {
        <div class="cart-items">
          @for (item of cartService.cartItems(); track item.product.id) {
            <div class="cart-item">
              <img [src]="item.product.image" [alt]="item.product.title" class="item-image">
              <div class="item-details">
                <h3>{{ item.product.title }}</h3>
                <p class="price">${{ item.product.price }}</p>
                <div class="quantity-controls">
                    <span>Qty: {{ item.quantity }}</span>
                </div>
              </div>
              <button class="remove-btn" (click)="cartService.removeFromCart(item.product.id)">Remove</button>
            </div>
          }
        </div>
        @if (cartService.cartItems().length > 0) {
          <div class="cart-summary">
            <h3>Total: ${{ cartService.totalPrice() | number:'1.2-2' }}</h3>
            <button class="checkout-btn" (click)="openCheckout()">Proceed to Checkout</button>
          </div>
        }
      }
    </div>
    
    <!-- Checkout Modal -->
    @if (showCheckoutModal()) {
      <div class="modal-overlay" (click)="closeCheckout()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <h2>Shipping Details</h2>
          <form (ngSubmit)="placeOrder()">
            <div class="form-group">
              <label for="name">Full Name</label>
              <input id="name" [(ngModel)]="customerName" name="name" required>
            </div>
            <div class="form-group">
              <label for="address">Shipping Address</label>
              <input id="address" [(ngModel)]="customerAddress" name="address" required>
            </div>
            <div class="modal-actions">
              <button type="button" class="btn-secondary" (click)="closeCheckout()">Cancel</button>
              <button type="submit" class="btn-primary">Place Order</button>
            </div>
          </form>
        </div>
      </div>
    }
    
    <!-- Order Success Popup -->
    @if (showOrderSuccess()) {
      <div class="success-popup">
        <p>ðŸŽ‰ Order placed successfully! Thank you for your purchase. ðŸŽ‰</p>
      </div>
    }
  } @else {
    <div class="login-prompt">
      <h2>Please Log In</h2>
      <p>You need to be logged in to view your cart and check out.</p>
      <a routerLink="/login" class="login-btn">Go to Login</a>
    </div>
  }
}